<div class="wrapper">
    <p-toast />
    <p-confirmdialog />
    <h2 class="title">Automation Rules</h2>
    <p class="subtitle">
        Define and monitor smart home rules — from motion triggers to energy-saving actions. Filter by type, status, or
        device.
    </p>
    <div class="filters">
        <p-floatlabel variant="in">
            <p-select [(ngModel)]="selectedRuleType" inputId="filter_type" [options]="ruleTypes" class="filter-dropdown"
                variant="filled" />
            <label for="filter_type">Filter by rule type</label>
        </p-floatlabel>

        <p-floatlabel variant="in">
            <p-select [(ngModel)]="selectedStatus" inputId="filter_status" [options]="statuses" class="filter-dropdown"
                variant="filled" />
            <label for="filter_status">Filter by status</label>
        </p-floatlabel>

        <p-floatlabel variant="in">
            <input pInputText id="filter_creator" [(ngModel)]="creatorFilter" autocomplete="off" />
            <label for="filter_creator">Filter by creator</label>
        </p-floatlabel>

        <div class="ml-auto">
            <p-button class="h-full" [raised]="true" severity="info" icon="pi pi-plus" type="button" label="Add new"
                (click)="openAddRuleDialog()" />
        </div>
    </div>

    <p-table [value]="filteredRules" responsiveLayout="scroll" class="table-data">
        <ng-template pTemplate="header">
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Condition</th>
                <th>Action</th>
                <th>Target Device</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Last Triggered</th>
                <th>Created By</th>
                <th>Actions</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rule>
            <tr>
                <td><i [ngClass]="rule.icon" class="mr-2"></i> {{ rule.name }}</td>
                <td>{{ rule.type }}</td>
                <td>{{ rule.condition }}</td>
                <td>{{ rule.action }}</td>
                <td>{{ rule.targetDevice?.name }}</td>
                <td>
                    <span [ngClass]="{
            'status-on': rule.status === 'Active',
            'status-off': rule.status === 'Inactive',
            'status-warning': rule.status === 'Error'
          }">{{ rule.status }}</span>
                </td>
                <td>{{ rule.priority }}</td>
                <td>{{ rule.lastTriggered || '—' }}</td>
                <td>{{ rule.createdBy || 'System' }}</td>
                <td class="flex gap-2 justify-center">
                    <p-button [icon]="getRuleButtonIcon(rule.status)" [raised]="true" class="action-btn"
                        [severity]="getRuleButtonSeverity(rule.status)" (onClick)="toggleRuleStatus(rule)" />
                    <p-button icon="pi pi-pencil" (click)="editRule(rule)" [raised]="true" class="action-btn"
                        severity="info" />
                    <p-button icon="pi pi-trash" [raised]="true" class="action-btn" severity="secondary"
                        (click)="deleteRule($event, rule._id, rule.name)" />
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>